**js中的作用域及其作用域链**

js中的作用域分为全局作用域和函数作用域。

但是可以根据语言特性模拟出块级作用域。



**全局作用域**

1. 在页面打开的时候创建，在页面关闭的时候销毁
2. 在全局作用域中定义的变量和函数，在任何位置都可以访问
3. 全局作用域中存在一个window对象，定义的变量和函数都会挂载在上面，作为属性和方法保存
4. window代表一个浏览器窗口，由浏览器创建，可以直接调用



**函数作用域**

1. 调用函数的时候才会创建，函数执行完毕，作用域销毁
2. 每调用一次函数，就会创建一个新的函数作用域，他们之间是相互独立的



**作用域的深层次理解**

1. 函数执行之前，会先进行预编译，创建一个AO对象，这个对象就是函数的作用域。

2. 会去找形参和变量声明，将形参名和变量名作为AO对象的属性，赋值为undefined

3. 实参和形参统一
4. 在函数体里面找函数声明，值赋予函数体



1. 全局作用域也是一样的，在js执行全局代码的时候，会先进行预编译，创建一个GO对象，这个对象就是全局作用域
2. 找变量声明，变量名作为GO对象的属性名，值为undefined
3. 找函数声明，值赋予函数体



```js
function fn(a, c) {
  console.log(a);
  var a = 123;

  console.log(a);
  console.log(c);

  function a() { }

  if (false) {
    var d = 678
  }

  console.log(d);
  console.log(b);

  // 不叫做函数声明，叫做函数表达式
  var b = function () { }

  console.log(b);

  function c() { }

  console.log(c);
}

fn(1, 2)
```



**作用域链**

1. 有了作用域，一定会有作用域链。

2. 作用域链就是AO和GO的集合。



**闭包**

所谓的闭包就是在js中，函数外部可以访问到函数内部的变量，本质是函数作用域链的特性，定义返回函数时可以看到其父函数的AO。

函数中存在一个属性 [[scope]] 保存了作用域链的集合。最上面是自己的，往外依次是别人的。

当前函数执行，形成一个私有的上下文，函数执行完，当前私有上下文中的某些内容，被上下文以外的内容占用，那么当前上下文就不能被释放。



