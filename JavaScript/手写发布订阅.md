**DOM0和DOM2的区别？**

1. 语法上
   - DOM0：box.onclick
   - DOM2：box.addEventListener
2. 底层机制上的区别
   - DOM0：有效绑定的方法只有一个，多了会覆盖
   - DOM2：基于事件池机制完成，每增加一个方法，就会往事件池中存放一个...，当事件触发会依次执行事件池中的事情
3. DOM2可以给一些特殊的事件类型绑定方法，这些事件类型DOM0不支持，例如：DOMContentLoaded、transitionend...



**发布订阅其实就是模拟事件池，同一个元素可以绑定多个不同的方法。**



**jQuery的发布订阅模式**

jQuery中的发布订阅模式利用 $.Callbacks方法完成，该方法返回一个事件池，事件池中有 fire、add、remove方法，分别是执行事件池中的方法，新增方法、移除方法。



**封装一个发布订阅的库**

```js
// 发布订阅的类
class Sub {
    constructor() {
        this.$pond = []; // 事件池
    }
    // 按顺序依次执行事件池中事件的方法
    fire(...args) {
        for (let i = 0; i < this.$pond.length; i++) {
            this.$pond[i] && this.$pond[i].apply(this, args);
        }
    }
    // 添加事件的方法
    add(fn) {
        // 新增事件的时候 需要去重
        if (!this.$pond.includes(fn)) {
            this.$pond.push(fn);
        }
    }
    // 只执行一次订阅
    once(fn) {
        function func() {
            fn && fn();
            this.remove(fn);
        }
        this.$pond.push(func);
    }
    // 移除事件的方法
    remove(fn) {
        for (let i = 0; i < this.$pond.length; i++) {
            if (this.$pond[i] === fn) {
                // 这样会导致数组塌陷 所以我们不能真移除
                // this.$pond.splice(i, 1);
                this.$pond[i] = null;
                break;
            }
        }
    }
}


// test
let pond = new Sub();
btn.addEventListener('click', function(ev) {
    pond.fire(ev);
});

let fn1 = function() {
    console.log('fn1')
}
let fn2 = function() {
    pond.remove(fn1)
    console.log('fn2')
}
let fn3 = function(e) {
    console.log('fn3', e)
}

pond.add(fn1);
pond.add(fn1);
pond.add(fn2);
pond.add(fn3);

// 某一时刻要做很多事情
```

