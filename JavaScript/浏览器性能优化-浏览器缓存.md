**什么是缓存？**

当我们第一次访问百度的时候，电脑会把网站上的图片和数据下载到本地，当我们再次访问该网站的时候，网站就会从本地直接加载出来。



**缓存有哪些好处？**

1. 缓解服务器压力，不用每次去请求某些数据
2. 提升性能，打开网站速度快
3. 减少带宽消耗



**web缓存分类**

数据库缓存、CDN缓存、代理服务器缓存、浏览器缓存



**浏览器缓存**

每个浏览器都已经实现了自己的http缓存，当浏览器通过http协议和服务器交互的时候，就会通过一套和服务器约定好的规则进行缓存，浏览器的回退和前进利用的就是浏览器缓存机制。

浏览器缓存的本质就是在本地使用的计算机中开辟一块内存区，在硬盘中开辟一块缓冲区，暂时保存用户访问过的信息。



**浏览器缓存的过程**

强缓存、协商缓存



**强缓存**

强缓存是当我们访问URL的时候，完全从缓存中获取，不去请求服务器，会返回200的状态码



**如何设置强缓存**

首次加载某一个页面，请求成功，服务器作出应答，浏览器根据响应头决定是否需要对资源进行缓存。

如果响应头中包含 expires、pragma或者cache-control时，则表示需要对资源进行缓存。而且是进行强缓存，浏览器会把资源存放在memory cache或disk cache中。

当再一次请求的时候，浏览器判断请求参数是否符合强缓存条件，如果符合直接返回200，从缓存拿数据返回。

如果不符合，把参数放在请求头中，看是否符合协商缓存，符合返回304，不符合返回全新资源。



**cache-control优先级高于expres，expires不准确，因为expires利用的是本地时间，而本地时间是可以修改的。cache-control使用了max-age相对时间，解决了expires这一弊病。**



**cache-control取值**

1. public，资源客户端和服务器都可以进行缓存
2. private：资源只有客户端可以缓存
3. no-cache：客户端缓存资源，但是是否缓存还需要经过协商缓存验证
4. no-store：不使用缓存
5. max-age：缓存有效期



**缓存位置**

图像和网页资源主要缓存在disk cache，操作系统缓存文件资源存放在memory cache。

位置查找顺序 memory cache > disk cache.



**协商缓存**

当强缓存失效之后，浏览器携带缓存标识向服务器发送请求，由服务器根据缓存标识决定是否使用缓存。

协商缓存生效，返回304

协商缓存失效，返回200和请求结果



如何设置协商缓存

1. 在请求头中设置 if-modified-since，他的值是上一次返回回来的 last-modified
   - If-Modified-Since则是客户端再次发起该请求时，携带上次请求返回的Last-Modified值，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。服务器收到该请求，发现请求头含有If-Modified-Since字段，则会根据If-Modified-Since的字段值与该资源在服务器的最后被修改时间做对比，若服务器的资源最后被修改时间大于If-Modified-Since的字段值，则重新返回资源，状态码为200；否则则返回304，代表资源无更新，可继续使用缓存文件
2. 在请求头中添加字段 if-none-match 他的值就是上一次服务器返回的 etag，所谓etag就是资源文件的唯一标识
   - If-None-Match是客户端再次发起该请求时，携带上次请求返回的唯一标识Etag值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有If-None-Match，则会根据If-None-Match的字段值与该资源在服务器的Etag值做对比，一致则返回304，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为200



**缓存方案**

1. HTML使用协商缓存
2. css、js、img：强缓存，文件名带上hash



**强缓存和协商缓存的区别**

1. 前者不发送请求到服务器，后者发送



**刷新对于强缓存和协商缓存的影响**

1. ctrl+f5，跳过强缓存和协商缓存，直接从服务器加载
2. f5，跳过强缓存，但是会检查协商缓存
3. 输入栏输入url，回车，会检查强缓存